# Maintainer: onefire <onefire.myself@gmail.com>
pkgname=hack-lenovo
pkgver=0.0.1
pkgrel=1
pkgdesc="Without this Kernel module, Optimus techonology on Lenovo Ideapad Y470/Y570/Y580 and Toshiba Satellite P870 does not work"
arch=('i686' 'x86_64')
url=("https://github.com/Bumblebee-Project/bbswitch/tree/hack-lenovo")
license=('GPL')
provides=('hack-lenovo')
conflicts=('acpi-handle-hack-lenovo')
makedepends=('linux-headers' 'git')
install=hack-lenovo.install
groups=('nvidia-cuda' 'custom')
_kernver=3.4

build() {
  git clone git://github.com/Bumblebee-Project/bbswitch.git -b hack-lenovo
  cd bbswitch
  sed 's/\/lib\/modules/\/usr\/lib\/modules/g' Makefile > junk && mv junk Makefile
  make clean
  make modname=acpi-handle-hack
  }

package() {
 cd $srcdir/bbswitch
 mkdir -p $pkgdir/usr/src/acpi-handle-hack-$pkgver
 cp Makefile acpi-handle-hack.c $pkgdir/usr/src/acpi-handle-hack-0.0.1
 cp dkms/acpi-handle-hack.conf $pkgdir/usr/src/acpi-handle-hack-0.0.1/dkms.conf
 install -D -m755 acpi-handle-hack.ko $pkgdir/usr/lib/modules/extramodules-$_kernver-ARCH/acpi-handle-hack.ko
}


